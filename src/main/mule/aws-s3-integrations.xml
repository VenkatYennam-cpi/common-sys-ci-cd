<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:file="http://www.mulesoft.org/schema/mule/file" xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core" xmlns:s3="http://www.mulesoft.org/schema/mule/s3"
	xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="
http://www.mulesoft.org/schema/mule/file http://www.mulesoft.org/schema/mule/file/current/mule-file.xsd http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/s3 http://www.mulesoft.org/schema/mule/s3/current/mule-s3.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd">

	<sub-flow name="sf-aws-delete-object" doc:id="4aac1c4d-b40b-4536-b2ea-585ad5ef4462">
		<logger level="INFO" doc:name="sf-aws-delete-object Flow Started" doc:id="03e55f50-ba4d-4ffc-a2cf-3130fd1aeb7f" message="sf-aws-delete-object Flow Started" />
		<s3:delete-object doc:name="Delete File" doc:id="0f7fc014-31c5-45a1-920d-05127625df50" bucketName="#[payload.folder_name]" key="#[payload.file_name]"
			versionId="#[payload.version_id]" config-ref="Amazon_S3_Configuration" />
		<logger level="INFO" doc:name="sf-aws-delete-object Flow Ended" doc:id="7a9d192b-a0ed-406b-8e1c-2d272f89651f" message="sf-aws-delete-object Flow Ended" />
	</sub-flow>
	<sub-flow name="sf-aws-copy-object" doc:id="a8ed4a41-1cc4-4429-a8ea-966f98d3a550">
		<logger level="INFO" doc:name="sf-aws-copy-object Flow Started" doc:id="51fd42e1-553e-44fb-983c-257e52f363dd" message="sf-aws-copy-object Flow Started" />
		<s3:copy-object doc:name="Copy File " doc:id="fb7638cc-4417-4972-a30e-c9309a10865b" config-ref="Amazon_S3_Configuration" sourceBucketName="#[payload.source_folder_name]"
			sourceKey="#[payload.source_file_name]" 	destinationBucketName="#[payload.destination_folder_name]" destinationKey="#[payload.destination_file_name]" />
		<ee:transform doc:name="Payload to JSON" doc:id="8bfe3739-2b0b-4e4b-888d-34fcd3b9d93c">
			<ee:message>
				<ee:set-payload resource="dwScripts/aws-copy-upload-response.dwl" />
			</ee:message>
		</ee:transform>
		<logger level="INFO" doc:name="sf-aws-copy-object Flow Ended" doc:id="780b1241-53bd-42f4-b093-039fd6c199cc" message="sf-aws-copy-object Flow Ended" />
	</sub-flow>
	<sub-flow name="sf-aws-list-object" doc:id="df1c6c74-77aa-4a1a-9ff4-5b69954fab38">
		<logger level="INFO" doc:name="sf-aws-list-object Flow Started" doc:id="9fcf98c7-9043-45b1-94f3-b63f0967192a" message="sf-aws-list-object Flow Started" />
		<s3:list-objects doc:name="List Files" doc:id="24f52566-872c-4012-b708-9d1d485a2abd" config-ref="Amazon_S3_Configuration" bucketName="#[payload.folder_name]"
			prefix="#[payload.prefix]" />
		<ee:transform doc:name="Payload to JSON" doc:id="bd5eb7bb-1ce7-462f-a88b-80acff70d64e">
			<ee:message>
				<ee:set-payload><![CDATA[%dw 2.0
output application/json
---
payload]]></ee:set-payload>
			</ee:message>
		</ee:transform>
		<logger level="INFO" doc:name="sf-aws-list-object Flow Ended" doc:id="b1f7ccea-3d7a-4056-ab84-a418852966cd" message="sf-aws-list-object Flow Ended" />
	</sub-flow>
	<sub-flow name="sf-aws-read-object" doc:id="c8baa2e5-685a-41f8-9684-4981d35641ac">
		<logger level="INFO" doc:name="sf-aws-read-object Flow Started" doc:id="52cab047-c28a-4930-9b9b-c7ae4aeb4c39" message="sf-aws-read-object Flow Started" />
		<s3:get-object doc:name="Get File Content" doc:id="480859af-ada1-47ca-85db-bd75c90baf32" config-ref="Amazon_S3_Configuration" bucketName="#[payload.folder_name]"
			key="#[payload.file_name]" versionId="#[payload.source_version_id]" modifiedSince="#[payload.modified_since]" unmodifiedSince="#[payload.unmodified_since]" />
		<ee:transform doc:name="Payload to JSON" doc:id="c4e26a91-bf0d-46a8-9d51-6f00c04f0ea1">
			<ee:message>
				<ee:set-payload><![CDATA[%dw 2.0
output application/json
import toBase64 from dw::core::Binaries
---
"content" : toBase64(payload)]]></ee:set-payload>
			</ee:message>
		</ee:transform>
		<logger level="INFO" doc:name="sf-aws-read-object Flow Ended" doc:id="27e5f3e9-3493-4408-bf11-dfd1fa0b40e0" message="sf-aws-read-object Flow Ended" />
	</sub-flow>
	<sub-flow name="sf-aws-upload-object" doc:id="0adb2e8d-9e9d-453f-a859-ca7b57b6d633">
		<logger level="INFO" doc:name="sf-aws-upload-object Flow Started" doc:id="558f56b6-f4a3-4ea1-b807-dc3c0cd9810e" message="sf-aws-upload-object Flow Started" />
		<s3:create-object doc:name="Create File" doc:id="6ccdea56-bb83-4fce-a654-14a4e32eb2a2" config-ref="Amazon_S3_Configuration" bucketName="#[payload.folder_name]"
			key="#[payload.file_name]">
			<s3:object-content><![CDATA[#[payload.content]]]></s3:object-content>
		</s3:create-object>
		<ee:transform doc:name="Payload to JSON" doc:id="cda1e07d-cd9c-497d-a08f-a1ca335d31a4">
			<ee:message>
				<ee:set-payload resource="dwScripts/aws-copy-upload-response.dwl" />
			</ee:message>
		</ee:transform>
		<logger level="INFO" doc:name="sf-aws-upload-object Flow Ended" doc:id="feac6d3b-a50b-47fd-a6a7-03eede2602ae" message="sf-aws-upload-object Flow Ended" />
	</sub-flow>
	<sub-flow name="sf-aws-secure-read-object" doc:id="f809f52a-a509-467e-b22e-ab909c066e98">
		<logger level="INFO" doc:name="sf-aws-secure-read-object Flow Started" doc:id="da3967c2-b6c0-43e0-a46e-bdb86ba9e955" message="sf-aws-secure-read-object Flow Started" />
		<ee:transform doc:name="DW Decrypt Secure payload" doc:id="3dc04415-e74c-481f-8fdf-0d462e0cb38a">
			<ee:message>
				<ee:set-payload resource="dwScripts/p-aws-decrypt-secure-payload.dwl" />
			</ee:message>
		</ee:transform>
		<logger level="INFO" doc:name="sf-aws-secure-read-object Flow Ended" doc:id="b630e42e-3dae-4e5d-aeeb-93703124e92d" message="sf-aws-secure-read-object Flow Ended" />
	</sub-flow>
	<sub-flow name="sf-aws-secure-copy-object" doc:id="051aaa35-d91b-4f32-81ab-bf68893a7ff6">
		<logger level="INFO" doc:name="sf-aws-secure-read-object Flow Started" doc:id="b890575e-7a9f-474a-9943-209d89026fb8" message="sf-aws-secure-copy-object Flow Started" />
		<ee:transform doc:name="DW Copy Secure payload" doc:id="692d6694-788c-435d-9921-a3a1cbee6062">
			<ee:message>
				<ee:set-payload resource="dwScripts/p-aws-copy-secure-payload.dwl" />
			</ee:message>
		</ee:transform>
		<ee:transform doc:name="DW Transform copy response" doc:id="4d68257a-47a2-454b-bdf7-47e38f9e88a2">
			<ee:message>
				<ee:set-payload resource="dwScripts/p-aws-copy-secure-response.dwl" />
			</ee:message>
		</ee:transform>
		<logger level="INFO" doc:name="sf-aws-secure-copy-object Flow Ended" doc:id="1518b7f4-0e2d-4853-a8a7-d478e7a0adc2" message="sf-aws-secure-copy-object Flow Ended" />
	</sub-flow>
	
</mule>
